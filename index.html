<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­ç´šå¤¢æƒ³å•†åŸ</title>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #f43f5e;
            --success: #10b981;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
        }

        body { 
            background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; 
            margin: 0;
            padding: 20px;
            display: flex; 
            justify-content: center;
            min-height: 100vh;
        }

        .box { 
            background: var(--card-bg); 
            border-radius: 24px; 
            padding: 24px; 
            width: 100%; 
            max-width: 500px; 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        h2 { text-align: center; color: var(--primary); font-size: 1.5rem; margin-bottom: 20px; }
        
        .section-title { 
            background: #f1f5f9; 
            color: #64748b; 
            padding: 6px 12px; 
            border-radius: 8px; 
            margin: 20px 0 10px 0; 
            font-weight: bold; 
            font-size: 0.9rem;
            border-left: 4px solid var(--primary);
        }

        .gift-item { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px 16px; 
            margin-bottom: 8px;
            transition: all 0.2s;
        }
        .gift-item.active { border-color: var(--primary); background: #f5f3ff; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.1); }
        .gift-item.out { opacity: 0.5; background: #f1f5f9; cursor: not-allowed; border-style: dashed; }

        .gift-info { display: flex; flex-direction: column; flex-grow: 1; }
        .gift-name { font-weight: 600; color: var(--text-main); }
        .gift-price { font-size: 0.85rem; color: var(--secondary); font-weight: bold; }

        .status-card {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            border-radius: 16px;
            padding: 20px;
            color: white;
            text-align: center;
            margin-bottom: 20px;
        }
        .point-display { font-size: 2.2rem; font-weight: 800; margin: 5px 0; }
        .point-label { font-size: 0.9rem; opacity: 0.9; }

        label { display: block; margin-bottom: 6px; font-weight: 600; color: #475569; font-size: 0.9rem; }
        select, input[type="password"], input[type="number"] { 
            width: 100%; padding: 12px; font-size: 16px; border-radius: 12px; 
            border: 1px solid #cbd5e1; box-sizing: border-box; margin-bottom: 16px;
        }

        .btn { 
            background: var(--primary); color: white; padding: 14px; width: 100%; border: none; 
            border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; 
            transition: all 0.2s; margin-top: 10px;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-secondary { background: #94a3b8; margin-top: 8px; }
        .btn-buy { background: var(--success); box-shadow: 0 4px 14px rgba(16, 185, 129, 0.3); }

        .stock-tag { font-size: 11px; padding: 2px 8px; border-radius: 20px; background: #f1f5f9; color: #64748b; margin-top: 4px; display: inline-block; width: fit-content; }
        .stock-low { background: #fee2e2; color: #ef4444; font-weight: bold; border: 1px solid #fecaca; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; background: white; border-radius: 8px; overflow: hidden; }
        th { background: #f1f5f9; padding: 12px 8px; text-align: left; }
        td { border-bottom: 1px solid #f1f5f9; padding: 12px 8px; }
        .admin-link { color: #94a3b8; font-size: 12px; text-align: center; margin-top: 30px; cursor: pointer; display: block; }
    </style>
</head>
<body>

<div class="box">
    <div id="page-login">
        <h2>âœ¨ é»æ•¸å…Œæ›å•†åº—</h2>
        <label>é¸ä½ çš„åå­—</label>
        <select id="user">
            <option value="">è«‹é»æ“Šé¸æ“‡åå­—...</option>
            <option>é»ƒæŸç¿”</option><option>é»ƒè© å…¶</option><option>ç‹å®¸ç¥</option><option>å³å¥•ç£Š</option>
            <option>æ¢è»’ç¶¸</option><option>å¼µå† æ£‹</option><option>å€™è–å¨</option><option>é™³å»ºç¦¾</option>
            <option>é™³æ¥·èŒ—</option><option>é»ƒç§‰æ˜±</option><option>æ´ªå‘ˆå¡</option><option>æ—éŸ¡å€«</option>
            <option>é»ƒå½¥é¾</option><option>ç›§ç¿æ–‡</option><option>æ—ä¾‘å¨</option><option>å¼µæƒ é›¯</option>
            <option>é„­ä»°ç¹</option><option>å†¼èŠ¸ç†™</option><option>ä¾¯æ˜æ™¨</option><option>åŠ‰å­Ÿæ¡</option>
            <option>ç‹ç´«ç¸ˆ</option><option>é‚±åº­ç‘œ</option><option>æœ±èŠƒåª—</option><option>åŠ‰èªæ™´</option>
            <option>å³å¹¸å¬¨</option><option>å¾éƒæ¶µ</option><option>é­ç‘œèŠ¯</option><option>è”¡æ±®å¦</option>
        </select>
        <label>è¼¸å…¥å€‹äººå¯†ç¢¼</label>
        <input type="password" id="pass" placeholder="è«‹è¼¸å…¥ 4 ä½å¯†ç¢¼" inputmode="numeric">
        <button class="btn" onclick="doLogin()">é€²å…¥å•†åº—</button>
    </div>

    <div id="page-shop" style="display:none;">
        <h3 id="who" style="text-align:center; color:#475569;">ä½ å¥½</h3>
        
        <div class="status-card">
            <div class="point-label">é è¨ˆå‰©é¤˜é»æ•¸</div>
            <div class="point-display" id="resP">0</div>
            <div class="point-label">Points</div>
        </div>

        <div style="background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 20px;">
            <label style="margin:0">ğŸ’ è¼¸å…¥è€å¸«çµ¦ä½ çš„é»æ•¸ï¼š</label>
            <input type="number" id="nowP" value="0" oninput="calc()" style="margin-top:10px; border-color: var(--primary); font-weight: bold;">
        </div>

        <div id="gifts-container"></div>

        <div style="margin-top: 25px;">
            <button id="buyBtn" class="btn btn-buy" onclick="doBuy()" disabled>è«‹å…ˆé¸æ“‡ç¦®ç‰©</button>
            <button class="btn btn-secondary" onclick="location.reload()">æ›äººç™»å‡º</button>
        </div>
    </div>

    <div id="page-admin" style="display:none;">
        <h3>ğŸ“Š ç®¡ç†å“¡å¾Œå°</h3>
        <div style="background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
            <b style="color: #64748b;">å³æ™‚åº«å­˜ï¼š</b>
            <div id="stockStatus" style="font-size: 13px; margin-top: 8px;"></div>
        </div>
        <b style="color: #64748b;">å…Œæ›ç´€éŒ„ï¼š</b>
        <div id="logTable" style="overflow-x: auto;"></div>
        <button class="btn" onclick="location.reload()">å›é¦–é </button>
    </div>

    <span class="admin-link" onclick="goAdmin()">è€å¸«ç®¡ç†å…¥å£</span>
</div>

<script>
    // æ›´æ–°å¾Œçš„åº«å­˜è¨­å®š
    var defaultStock = {
        "éº¥å¡Šäººç‰©": 3, 
        "å¯¶å¯å¤¢æ¡ŒéŠ": 1, 
        "æ¨‚é«˜": 3, 
        "æ‹¼åœ–": 3,
        "DIYæ‰‹åšç‡ˆ": 1, 
        "é»å¿ƒéºµç²‰å½©ç­†": 1,
        "åˆä½œç¤¾10å…ƒå·": 30,
        "æ¦®è­½å¡1é»": 999, "é€ å‹è²¼ç´™": 999, "é£Ÿç‰©ç›²è¢‹": 999, "å¯¦ç”¨æ–‡å…·": 999,
        "å°åŒ…é›¶é£Ÿ": 999, "é‹ç®”åŒ…é£²æ–™": 999, "é©šå–œç›²ç›’": 999
    };

    // æ›´æ–°å¾Œçš„å•†å“æ¸…å–®
    var giftData = [
        { c: "ä¸€ã€æ–‡å…·èˆ‡å°ç‰©", items: [
            {n:"æ¦®è­½å¡1é»", p:1}, {n:"åˆä½œç¤¾10å…ƒå·", p:10}, {n:"é€ å‹è²¼ç´™", p:20}, {n:"é£Ÿç‰©ç›²è¢‹", p:20}, {n:"å¯¦ç”¨æ–‡å…·", p:30}
        ]},
        { c: "äºŒã€é›¶é£Ÿèˆ‡ç´“å£“", items: [
            {n:"å°åŒ…é›¶é£Ÿ", p:60}, {n:"é‹ç®”åŒ…é£²æ–™", p:80}, {n:"é©šå–œç›²ç›’", p:100}
        ]},
        { c: "ä¸‰ã€ç‰¹æ®Šç¦®ç‰© (é™é‡)", items: [
            {n:"éº¥å¡Šäººç‰©", p:120}, {n:"å¯¶å¯å¤¢æ¡ŒéŠ", p:150}, {n:"æ¨‚é«˜", p:120}, {n:"æ‹¼åœ–", p:120}, 
            {n:"DIYæ‰‹åšç‡ˆ", p:120}, {n:"é»å¿ƒéºµç²‰å½©ç­†", p:120}
        ]}
    ];

    function getDB() {
        return JSON.parse(localStorage.getItem('SHOP_V2')) || { uP: {}, logs: [], stock: defaultStock };
    }

    function renderShop() {
        var db = getDB();
        var gHtml = "";
        for(var i=0; i<giftData.length; i++) {
            gHtml += '<div class="section-title">' + giftData[i].c + '</div>';
            for(var j=0; j<giftData[i].items.length; j++) {
                var item = giftData[i].items[j];
                var stockCount = db.stock[item.n] || 0;
                var isOut = stockCount <= 0;
                
                // åªè¦åº«å­˜å°æ–¼ 10 å°±é¡¯ç¤ºå‰©é¤˜æ•¸é‡æ¨™ç±¤
                var stockLabel = "";
                if (stockCount < 10) {
                    stockLabel = `<span class="stock-tag ${stockCount <= 2 ? 'stock-low' : ''}">å‰© ${stockCount} ä»¶</span>`;
                }

                gHtml += `
                <div class="gift-item ${isOut ? 'out' : ''}" id="item-${i}-${j}">
                    <div class="gift-info" onclick="toggleItem('${i}-${j}')">
                        <span class="gift-name">${item.n} ${isOut ? '(å·²æ›å®Œ)' : ''}</span>
                        <span class="gift-price">ğŸ’ ${item.p} é»</span>
                        ${stockLabel}
                    </div>
                    <input type="checkbox" class="chk" data-n="${item.n}" data-p="${item.p}" 
                           onchange="handleCheck(this, 'item-${i}-${j}')" 
                           ${isOut ? 'disabled' : ''}>
                </div>`;
            }
        }
        document.getElementById('gifts-container').innerHTML = gHtml;
    }

    function toggleItem(idSuffix) {
        var chk = document.querySelector(`#item-${idSuffix} .chk`);
        if (!chk.disabled) {
            chk.checked = !chk.checked;
            handleCheck(chk, `item-${idSuffix}`);
        }
    }

    function handleCheck(chk, id) {
        var el = document.getElementById(id);
        if(chk.checked) el.classList.add('active');
        else el.classList.remove('active');
        calc();
    }

    function doLogin() {
        var u = document.getElementById('user').value;
        var p = document.getElementById('pass').value;
        if(!u || !p) { alert("è«‹å¡«å¯«åå­—èˆ‡å¯†ç¢¼ï¼"); return; }
        var db = getDB();
        if(!db.uP[u]) db.uP[u] = p;
        if(db.uP[u] === p) {
            document.getElementById('who').innerText = "â­ " + u + " æ­£åœ¨æŒ‘é¸ç¦®ç‰©";
            document.getElementById('page-login').style.display = "none";
            document.getElementById('page-shop').style.display = "block";
            renderShop();
        } else { alert("å¯†ç¢¼ä¸å°å–”ï¼"); }
        localStorage.setItem('SHOP_V2', JSON.stringify(db));
    }

    function calc() {
        var total = parseInt(document.getElementById('nowP').value) || 0;
        var cost = 0;
        var chks = document.getElementsByClassName('chk');
        for(var i=0; i<chks.length; i++) if(chks[i].checked) cost += parseInt(chks[i].getAttribute('data-p'));
        var remain = total - cost;
        
        var resEl = document.getElementById('resP');
        resEl.innerText = remain;
        resEl.style.color = remain < 0 ? "#ff4d4f" : "white";

        var btn = document.getElementById('buyBtn');
        if (total === 0) { btn.disabled = true; btn.innerText = "è«‹è¼¸å…¥é»æ•¸"; }
        else if (remain < 0) { btn.disabled = true; btn.innerText = "é»æ•¸ä¸å¤ æ›å–”ï¼"; }
        else if (cost === 0) { btn.disabled = true; btn.innerText = "é¸å€‹ç¦®ç‰©å§"; }
        else { btn.disabled = false; btn.innerText = "ç¢ºå®šæ›é€™äº›ç¦®ç‰©"; }
    }

    function doBuy() {
        var u = document.getElementById('user').value;
        var db = getDB();
        var items = [];
        var chks = document.getElementsByClassName('chk');
        for(var i=0; i<chks.length; i++){
            if(chks[i].checked) {
                var name = chks[i].getAttribute('data-n');
                if(db.stock[name] > 0) {
                    items.push(name);
                    db.stock[name] -= 1;
                } else {
                    alert(name + " å‰›å¥½æ›å®Œäº†ï¼");
                    return;
                }
            }
        }
        
        db.logs.push({ t: new Date().toLocaleString(), n: u, it: items.join(", "), re: document.getElementById('resP').innerText });
        localStorage.setItem('SHOP_V2', JSON.stringify(db));
        alert("æ­å–œå…Œæ›å®Œæˆï¼");
        location.reload();
    }

    function goAdmin() {
        var pass = prompt("ç®¡ç†å¯†ç¢¼ï¼š");
        if(pass === "teacher123") {
            document.getElementById('page-login').style.display = "none";
            document.getElementById('page-shop').style.display = "none";
            document.getElementById('page-admin').style.display = "block";
            var db = getDB();
            var sHtml = "";
            for(var key in db.stock) {
                if(db.stock[key] < 500) {
                    sHtml += `<span style="padding:4px 8px; background:#eee; border-radius:4px; margin:2px; display:inline-block">${key}: <b>${db.stock[key]}</b></span> `;
                }
            }
            document.getElementById('stockStatus').innerHTML = sHtml;
            var h = "<table><tr><th>å§“å</th><th>æ›äº†ä»€éº¼</th><th>é¤˜é¡</th></tr>";
            for(var i=db.logs.length-1; i>=0; i--) h += `<tr><td>${db.logs[i].n}</td><td>${db.logs[i].it}</td><td>${db.logs[i].re}</td></tr>`;
            document.getElementById('logTable').innerHTML = h + "</table>";
        }
    }
</script>
</body>
</html>
