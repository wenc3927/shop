<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­ç´šå¤¢æƒ³å•†åŸ - æ•¸é‡ç‰ˆ</title>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #f43f5e;
            --success: #10b981;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
        }

        body { 
            background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; 
            margin: 0; padding: 20px; display: flex; justify-content: center; min-height: 100vh;
        }

        .box { 
            background: var(--card-bg); border-radius: 24px; padding: 24px; 
            width: 100%; max-width: 500px; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }

        h2 { text-align: center; color: var(--primary); margin-bottom: 20px; }
        
        .status-card {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            border-radius: 16px; padding: 20px; color: white; text-align: center; margin-bottom: 20px;
        }
        .point-display { font-size: 2.2rem; font-weight: 800; }

        .section-title { 
            background: #f1f5f9; color: #64748b; padding: 8px 12px; border-radius: 8px; 
            margin: 20px 0 10px 0; font-weight: bold; border-left: 4px solid var(--primary);
        }

        .gift-item { 
            display: flex; align-items: center; justify-content: space-between; 
            background: #fff; border: 1px solid #e2e8f0; border-radius: 12px;
            padding: 12px 16px; margin-bottom: 8px; transition: 0.2s;
        }
        .gift-item.active { border-color: var(--primary); background: #f5f3ff; }
        .gift-item.out { opacity: 0.5; background: #f1f5f9; }

        .gift-info { flex-grow: 1; }
        .gift-name { font-weight: 600; display: block; }
        .gift-price { color: var(--secondary); font-weight: bold; font-size: 0.9rem; }
        .stock-tag { font-size: 11px; color: #94a3b8; }

        /* æ•¸é‡æ§åˆ¶å™¨ */
        .qty-control { display: flex; align-items: center; gap: 8px; }
        .qty-btn { 
            width: 30px; height: 30px; border-radius: 8px; border: 1px solid #cbd5e1;
            background: white; cursor: pointer; font-weight: bold; font-size: 18px;
        }
        .qty-btn:active { background: #f1f5f9; }
        .qty-input { 
            width: 40px; text-align: center; border: none; font-weight: bold; 
            font-size: 16px; background: transparent;
        }

        .btn { 
            background: var(--primary); color: white; padding: 14px; width: 100%; border: none; 
            border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px;
        }
        .btn:disabled { background: #cbd5e1; cursor: not-allowed; }
        .btn-buy { background: var(--success); box-shadow: 0 4px 14px rgba(16, 185, 129, 0.3); }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        th, td { border-bottom: 1px solid #f1f5f9; padding: 10px; text-align: left; }
        .admin-link { color: #94a3b8; font-size: 12px; text-align: center; margin-top: 30px; cursor: pointer; display: block; }
    </style>
</head>
<body>

<div class="box">
    <div id="page-login">
        <h2>âœ¨ é»æ•¸å…Œæ›å•†åº—</h2>
        <label style="font-size:0.9rem; color:#64748b;">é¸ä½ çš„åå­—</label>
        <select id="user" style="width:100%; padding:12px; border-radius:12px; margin-bottom:15px; border:1px solid #cbd5e1;">
            <option value="">è«‹é»æ“Šé¸æ“‡åå­—...</option>
            <option>é»ƒæŸç¿”</option><option>é»ƒè© å…¶</option><option>ç‹å®¸ç¥</option><option>å³å¥•ç£Š</option>
            <option>æ¢è»’ç¶¸</option><option>å¼µå† æ£‹</option><option>å€™è–å¨</option><option>é™³å»ºç¦¾</option>
            <option>é™³æ¥·èŒ—</option><option>é»ƒç§‰æ˜±</option><option>æ´ªå‘ˆå¡</option><option>æ—éŸ¡å€«</option>
            <option>é»ƒå½¥é¾</option><option>ç›§ç¿æ–‡</option><option>æ—ä¾‘å¨</option><option>å¼µæƒ é›¯</option>
            <option>é„­ä»°ç¹</option><option>å†¼èŠ¸ç†™</option><option>ä¾¯æ˜æ™¨</option><option>åŠ‰å­Ÿæ¡</option>
            <option>ç‹ç´«ç¸ˆ</option><option>é‚±åº­ç‘œ</option><option>æœ±èŠƒåª—</option><option>åŠ‰èªæ™´</option>
            <option>å³å¹¸å¬¨</option><option>å¾éƒæ¶µ</option><option>é­ç‘œèŠ¯</option><option>è”¡æ±®å¦</option>
        </select>
        <label style="font-size:0.9rem; color:#64748b;">è¼¸å…¥å€‹äººå¯†ç¢¼</label>
        <input type="password" id="pass" placeholder="ç¬¬ä¸€æ¬¡ç™»å…¥å³è¨­å®šå¯†ç¢¼" style="width:100%; padding:12px; border-radius:12px; margin-bottom:15px; border:1px solid #cbd5e1;" inputmode="numeric">
        <button class="btn" onclick="doLogin()">é€²å…¥å•†åº—</button>
    </div>

    <div id="page-shop" style="display:none;">
        <h3 id="who" style="text-align:center; color:#475569;">ä½ å¥½</h3>
        
        <div class="status-card">
            <div style="font-size:0.9rem; opacity:0.9;">é è¨ˆå‰©é¤˜é»æ•¸</div>
            <div class="point-display" id="resP">0</div>
        </div>

        <div style="background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 20px;">
            <label>ğŸ’ è€å¸«çµ¦ä½ çš„é»æ•¸ï¼š</label>
            <input type="number" id="nowP" value="0" oninput="calc()" style="width:100%; padding:10px; border:2px solid #6366f1; border-radius:8px; font-size:18px; font-weight:bold;">
        </div>

        <div id="gifts-container"></div>

        <div style="margin-top: 25px;">
            <button id="buyBtn" class="btn btn-buy" onclick="doBuy()" disabled>è«‹å…ˆé¸æ“‡æ•¸é‡</button>
            <button class="btn" style="background:#94a3b8" onclick="location.reload()">ç™»å‡ºæ›äºº</button>
        </div>
    </div>

    <div id="page-admin" style="display:none;">
        <h3>ğŸ“Š ç®¡ç†å“¡å¾Œå°</h3>
        <div id="stockStatus" style="font-size: 13px; margin-bottom: 20px;"></div>
        <b>å…Œæ›ç´€éŒ„ï¼š</b>
        <div id="logTable" style="overflow-x: auto;"></div>
        <button class="btn" onclick="location.reload()">å›é¦–é </button>
    </div>

    <span class="admin-link" onclick="goAdmin()">è€å¸«ç®¡ç†å…¥å£</span>
</div>

<script>
    // åˆå§‹åº«å­˜èˆ‡è³‡æ–™
    var defaultStock = {
        "éº¥å¡Šäººç‰©": 3, "å¯¶å¯å¤¢æ¡ŒéŠ": 1, "æ¨‚é«˜": 3, "æ‹¼åœ–": 3, "DIYæ‰‹åšç‡ˆ": 1, 
        "é»å¿ƒéºµç²‰å½©ç­†": 1, "åˆä½œç¤¾10å…ƒå·": 30, "æ¦®è­½å¡1é»": 999, "é€ å‹è²¼ç´™": 999, 
        "é£Ÿç‰©ç›²è¢‹": 999, "å¯¦ç”¨æ–‡å…·": 999, "å°åŒ…é›¶é£Ÿ": 999, "é‹ç®”åŒ…é£²æ–™": 999, "é©šå–œç›²ç›’": 999
    };

    var giftData = [
        { c: "ä¸€ã€æ–‡å…·èˆ‡å°ç‰©", items: [{n:"æ¦®è­½å¡1é»", p:1}, {n:"åˆä½œç¤¾10å…ƒå·", p:10}, {n:"é€ å‹è²¼ç´™", p:20}, {n:"é£Ÿç‰©ç›²è¢‹", p:20}, {n:"å¯¦ç”¨æ–‡å…·", p:30}]},
        { c: "äºŒã€é›¶é£Ÿèˆ‡ç´“å£“", items: [{n:"å°åŒ…é›¶é£Ÿ", p:60}, {n:"é‹ç®”åŒ…é£²æ–™", p:80}, {n:"é©šå–œç›²ç›’", p:100}]},
        { c: "ä¸‰ã€ç‰¹æ®Šç¦®ç‰© (é™é‡)", items: [{n:"éº¥å¡Šäººç‰©", p:120}, {n:"å¯¶å¯å¤¢æ¡ŒéŠ", p:150}, {n:"æ¨‚é«˜", p:120}, {n:"æ‹¼åœ–", p:120}, {n:"DIYæ‰‹åšç‡ˆ", p:120}, {n:"é»å¿ƒéºµç²‰å½©ç­†", p:120}]}
    ];

    function getDB() {
        return JSON.parse(localStorage.getItem('SHOP_V3')) || { uP: {}, logs: [], stock: defaultStock };
    }

    function renderShop() {
        var db = getDB();
        var gHtml = "";
        giftData.forEach((group, gIdx) => {
            gHtml += `<div class="section-title">${group.c}</div>`;
            group.items.forEach((item, iIdx) => {
                var stock = db.stock[item.n] || 0;
                var isOut = stock <= 0;
                gHtml += `
                <div class="gift-item ${isOut ? 'out' : ''}" id="box-${gIdx}-${iIdx}">
                    <div class="gift-info">
                        <span class="gift-name">${item.n}</span>
                        <span class="gift-price">ğŸ’ ${item.p} é»</span>
                        <span class="stock-tag">åº«å­˜: ${stock}</span>
                    </div>
                    <div class="qty-control">
                        <button class="qty-btn" onclick="changeQty('${gIdx}-${iIdx}', -1)" ${isOut?'disabled':''}>-</button>
                        <input type="number" class="qty-input" id="qty-${gIdx}-${iIdx}" 
                               data-n="${item.n}" data-p="${item.p}" data-max="${stock}" 
                               value="0" readonly>
                        <button class="qty-btn" onclick="changeQty('${gIdx}-${iIdx}', 1)" ${isOut?'disabled':''}>+</button>
                    </div>
                </div>`;
            });
        });
        document.getElementById('gifts-container').innerHTML = gHtml;
    }

    function changeQty(id, delta) {
        var input = document.getElementById('qty-' + id);
        var box = document.getElementById('box-' + id);
        var current = parseInt(input.value) || 0;
        var max = parseInt(input.dataset.max);
        var next = current + delta;
        
        if(next >= 0 && next <= max) {
            input.value = next;
            if(next > 0) box.classList.add('active');
            else box.classList.remove('active');
            calc();
        }
    }

    function doLogin() {
        var u = document.getElementById('user').value;
        var p = document.getElementById('pass').value;
        if(!u || !p) return alert("è«‹å¡«å¯«åå­—èˆ‡å¯†ç¢¼ï¼");
        var db = getDB();
        if(!db.uP[u]) db.uP[u] = p;
        if(db.uP[u] === p) {
            document.getElementById('who').innerText = "â­ " + u + " çš„è³¼ç‰©æ™‚å…‰";
            document.getElementById('page-login').style.display = "none";
            document.getElementById('page-shop').style.display = "block";
            renderShop();
            localStorage.setItem('SHOP_V3', JSON.stringify(db));
        } else alert("å¯†ç¢¼éŒ¯èª¤ï¼");
    }

    function calc() {
        var total = parseInt(document.getElementById('nowP').value) || 0;
        var cost = 0;
        var inputs = document.getElementsByClassName('qty-input');
        for(var input of inputs) {
            cost += (parseInt(input.value) || 0) * parseInt(input.dataset.p);
        }
        var remain = total - cost;
        var resEl = document.getElementById('resP');
        resEl.innerText = remain;
        resEl.style.color = remain < 0 ? "#ff4d4f" : "white";

        var btn = document.getElementById('buyBtn');
        btn.disabled = (total <= 0 || cost <= 0 || remain < 0);
        if(remain < 0) btn.innerText = "é»æ•¸ä¸å¤ å–”ï¼";
        else if(cost > 0) btn.innerText = `ç¢ºå®šå…Œæ› (èŠ±è²» ${cost} é»)`;
        else btn.innerText = "è«‹é¸æ“‡æ•¸é‡";
    }

    function doBuy() {
        if(!confirm("ç¢ºå®šè¦å…Œæ›å—ï¼Ÿé€å‡ºå¾Œç„¡æ³•ä¿®æ”¹å–”ï¼")) return;
        var u = document.getElementById('user').value;
        var db = getDB();
        var itemsLog = [];
        var inputs = document.getElementsByClassName('qty-input');

        for(var input of inputs) {
            var count = parseInt(input.value) || 0;
            if(count > 0) {
                var name = input.dataset.n;
                db.stock[name] -= count;
                itemsLog.push(`${name}x${count}`);
            }
        }
        
        db.logs.push({ t: new Date().toLocaleString(), n: u, it: itemsLog.join(", "), re: document.getElementById('resP').innerText });
        localStorage.setItem('SHOP_V3', JSON.stringify(db));
        alert("æ­å–œå…Œæ›æˆåŠŸï¼è«‹çµ¦è€å¸«ç¢ºèª");
        location.reload();
    }

    function goAdmin() {
        var pass = prompt("ç®¡ç†å¯†ç¢¼ï¼š");
        if(pass === "teacher123") {
            document.getElementById('page-login').style.display = "none";
            document.getElementById('page-shop').style.display = "none";
            document.getElementById('page-admin').style.display = "block";
            var db = getDB();
            var sHtml = "";
            for(var key in db.stock) sHtml += `<span style="padding:4px 8px; background:#eee; border-radius:4px; margin:2px; display:inline-block">${key}: <b>${db.stock[key]}</b></span> `;
            document.getElementById('stockStatus').innerHTML = sHtml;
            var h = "<table><tr><th>å§“å</th><th>æ›äº†ä»€éº¼</th><th>é¤˜é¡</th></tr>";
            for(var i=db.logs.length-1; i>=0; i--) h += `<tr><td>${db.logs[i].n}</td><td>${db.logs[i].it}</td><td>${db.logs[i].re}</td></tr>`;
            document.getElementById('logTable').innerHTML = h + "</table>";
        }
    }
</script>
</body>
</html>
